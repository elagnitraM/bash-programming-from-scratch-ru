## Инструменты для разработки

В прошлой главе для ввода команд Bash мы использовали эмулятор терминала. При этом набранный текст сохранялся в памяти эмулятора. Эта память физически находится в RAM компьютера, которая является временной. После исполнения команда сохранялась в файле `~/.bash_history`.

Терминала будет недостаточно для разработки программ. Вам понадобится удобный [редактор](https://ru.wikipedia.org/wiki/Редактор_исходного_кода), который позволит создавать файлы с исходным кодом и сохранять их на жёстком диске.

### Редактор исходного кода

Писать Bash скрипты можно в любом текстовом редакторе, в том числе и в стандартном приложении [Notepad](https://ru.wikipedia.org/wiki/Блокнот_(программа)) (Блокнот). Но работать с ним будет неудобно, поскольку у Блокнота нет дополнительных возможностей для редактирования исходного кода. Чтобы работать продуктивно, попробуйте несколько приложений, специально разработанных для этой цели, и выберите из них понравившееся.

В это разделе мы рассмотрим только три популярных редактора исходного кода. Но на самом деле их намного больше.

W> Обратите внимание, что офисный пакет MS Office и его открытый аналог [LibreOffice](https://ru.wikipedia.org/wiki/LibreOffice) не подходят для написания кода. Они по умолчанию используют бинарные или [XML-подобные](https://ru.wikipedia.org/wiki/XML) форматы для сохранения файлов. Интерпретаторы и компиляторы не смогут их прочитать. Редакторы исходного кода по умолчанию сохраняют данные в текстовых файлах.

[**Notepad++**](https://ru.wikipedia.org/wiki/Notepad++#cite_note-8) — это быстрый и минималистичный свободный редактор с открытым исходным кодом. Для работы ему требуется ОС Windows. Поэтому если вы используете macOS или Linux, лучше рассмотреть другие варианты. Последнюю версию Notepad++ можно загрузить с [официального сайта](https://notepad-plus-plus.org/downloads/).

[**Sublime Text**](https://ru.wikipedia.org/wiki/Sublime_Text#cite_note-Features-4) — проприетарный [**кросс-платформенный**](https://ru.wikipedia.org/wiki/Кроссплатформенность) редактор. Кросс-платформенность означает, что программа запускается на разных ОС или [**аппаратных платформах**](https://ru.wikipedia.org/wiki/Аппаратная_платформа_компьютера). Вы можете использовать Sublime Text без регистрации бесплатно. Но в этом режиме редактор регулярно выводит диалоговое окно с предложением купить лицензию. Загрузить программу можно c [официального сайта](https://www.sublimetext.com/).

[*Visual Studio Code*](https://ru.wikipedia.org/wiki/Visual_Studio_Code) — свободный кросс-платформенный редактор от компании Microsoft с открытым исходным кодом. Он доступен для загрузки с [официального сайта](https://code.visualstudio.com/).

Все перечисленные редакторы предоставляют следующие возможности для работы с исходным кодом:

* [Подсветка синтаксиса](https://ru.wikipedia.org/wiki/Подсветка_синтаксиса).
* [Автодополнение](https://ru.wikipedia.org/wiki/Автодополнение)
* Поддержка и конвертирование широко распространённых [кодировок](https://ru.wikipedia.org/wiki/Набор_символов).

Конечно, редактировать исходный код можно и без этих возможностей. Но они ускоряют работу и облегчают поиск ошибок в программе.

### Интеграция редактора с Bash

Редактор исходного кода запускается через графический интерфейс ОС, как и любая другая программа. Например, в случае Windows — через меню Пуск или иконку рабочего стола.

Если вы предпочитаете запускать редактор из командной строки Bash, есть несколько способов. В прошлой главе мы рассмотрели варианты запуска приложений по абсолютному и относительному путям, а также по имени исполняемого файла. Для последнего варианта вам нужно добавить путь к каталогу установки редактора в переменную окружения `PATH`.

Для примера запустим редактор Notepad++ из командной строки. Его путь установки по умолчанию следующий:
{line-numbers: false}
```
C:\Program Files (86)\Notepad++
```

Вы всегда можете уточнить его в свойствах ярлыка на рабочем столе или в меню Пуск. В Unix-окружении этот путь будет выглядеть следующим образом:
{line-numbers: false}
```
/c/Program Files (x86)/Notepad++
```

Если вы попробуете запустить Notepad++ по этому абсолютному пути, будет выведено сообщение об ошибке как на иллюстрации 3-1.

{caption: "Иллюстрация 3-1. Результат запуска Notepad++"}
![Результат запуска Notepad++](images/BashScripting/notepad-error.png)

В чём причина ошибки? На самом деле в этой команде есть несколько проблем. Рассмотрим их по порядку. Для начала попробуем выполнить следующую команду `cd`:
{line-numbers: false, format: Bash}
```
cd /c/Program Files
```

Результат её выполнения приведён на иллюстрации 3-2.

{caption: "Иллюстрация 3-2. Результат выполнения `cd`"}
![Результат cd](images/BashScripting/cd-many-arguments.png)

Bash сообщает нам о том, что в команду было передано больше параметров, чем нужно. Как вы помните, `cd` принимает на вход путь к целевому каталогу. Ошибка возникла из-за word splitting: Bash интерпретирует пробел не как часть пути, а как разделитель между двумя параметрами. Таким образом в команду `cd` передаются два пути: `/c/Program` и `Files`.

Есть два способа избежать подобной ошибки:

1. Заключить весь путь в двойные кавычки: {line-numbers: false, format: Bash}
```
cd "/c/Program Files"
```

2. Экранировать все пробелы с помощью обратного слэша:
{line-numbers: false, format: Bash}
```
cd /c/Program\ Files
```

Если выполнить каждую из этих команд, они отработают корректно.

Теперь попробуем перейти по пути `/c/Program Files (x86)`:
{line-numbers: false, format: Bash}
```
cd /c/Program Files (x86)
```

Как мы выяснили, Bash обрабатывает пробелы по своему усмотрению. Поэтом экранируем их с помощью обратного слэша:
{line-numbers: false, format: Bash}
```
cd /c/Program\ Files\ (x86)
```

Эта команда всё равно завершится с ошибкой, как на иллюстрации 3-3.

{caption: "Иллюстрация 3-3. Результат выполнения `cd`"}
![Результат cd](images/BashScripting/cd-unexpected-token.png)

Эту же ошибку мы получили при запуске Notepad++ (см. иллюстрацию 3-1). Проблема заключается в том, что кавычки `(` и `)` являются частью синтаксиса Bash. Поэтому интерпретатор пытается обработать их как конструкцию языка. Мы уже сталкивались с этой проблемой, когда группировали выражения команды `find`. Для её решения опять же подойдёт экранирование или двойные кавычки:
{line-numbers: true, format: Bash}
```
 cd /c/Program\ Files\ \(x86\)
 cd "/c/Program Files (x86)"
```

В результате экспериментов, мы пришли к следующей команде для запуска Notepad++ по абсолютному:
{line-numbers: false, format: Bash}
```
"/c/Program Files (x86)/Notepad++/notepad++.exe"
```

Если нужно запустить редактор Notepad++ по имени исполняемого файла, достаточно добавить его путь установки в переменную `PATH`. Для этого в конец файла `~/.bash_profile` добавьте следующую строку:
{line-numbers: false, format: Bash}
```
PATH="/c/Program Files (x86)/Notepad++:${PATH}"
```

Закройте и снова откройте терминал MSYS2. Теперь Notepad++ запускается следующей командой:
{line-numbers: false, format: Bash}
```
notepad++.exe
```

Вместо редактирования переменной `PATH` можно воспользоваться командой alias. Он назначает псевдоним для какой-то команды. После этого вы можете набрать псевдоним и вместо него будет исполнена соответствующая команда. Единственное назначение этого механизма — сокращать набор длинных строк в окне терминала.

Объявим псевдоним `notepad++` для следующей строки:
{line-numbers: false, format: Bash}
```
"/c/Program Files (x86)/Notepad++/notepad++.exe"
```

Для этого выполните команду:
{line-numbers: false, format: Bash}
```
alias notepad++="/c/Program\ Files\ \(x86\)/Notepad++/notepad++.exe"
```

Теперь Bash, встретив команду `notepad++`, будет запускать редактор по указанному нами абсолютному пути. Единственная проблема этого решения заключается в том, что псевдоним придётся определять каждый раз после перезапуска терминала MSYS2. Чтобы это происходило автоматически, можно добавить команду alias в файл `~/.bashrc`. Bash всегда исполняет этот файл перед запуском терминала.

После интеграции Notepad++ в Bash, вы можете открывать файлы на редактирование из командной строки. Для этого просто передайте имя файла первым параметром:
{line-numbers: false, format: Bash}
```
notepad++ test.txt
```

Если файла `test.txt` не существует, откроется диалог с предложением его создать.

Окно терминала нельзя использовать для ввода команд после запуска в нём графического приложения (например, Notepad++). Приложение будет выводить в него диагностические сообщения об ошибках. Только после его завершения, терминал заработает в обычном режиме.

Чтобы использовать окно терминала дальше, можно запустить приложение в **фоновом режиме** (background). Для этого добавьте амперсанд `&` в конце команды:
{line-numbers: false, format: Bash}
```
notepad++ test.txt &
```

В результате окно терминала по-прежнему будет использоваться для вывода сообщений приложения, но вы сможете вводить Bash команды. Если нужно полностью разделить окно терминал и запущенное приложение, воспользуйтесь встроенной командой `disown` с опцией `-a`:
{line-numbers: false, format: Bash}
```
disown -a
```

В результате вывод сообщений в окно терминала прекратится, а его закрытие не помешает работе приложения.

Команды запуска Notepad++ и `disown` можно объединить в одну:
{line-numbers: false, format: Bash}
```
notepad++ test.txt & disown -a
```

Параметр `-a` команды `disown` отделяет все приложения запущенные в фоновом режиме. Вы можете воспользоваться переменной окружения Bash `$!`, чтобы отделить только последнюю запущенную программу. Переменная хранит её идентификатор, известный как [PID](https://ru.wikipedia.org/wiki/Идентификатор_процесса). В этом случае команда запуска Notepad++ будет выглядеть так:
{line-numbers: false, format: Bash}
```
notepad++ test.txt & disown $!
```

Чтобы вывести список и PID всех приложений, запущенных в фоновом режиме, наберите команду `jobs` с опцией `-l`:
{line-numbers: false, format: Bash}
```
jobs -l
```