## Операционные системы

### История возникновения ОС

Подавляющее большинство пользователей компьютера понимает, зачем нужна [**операционная система**](https://ru.wikipedia.org/wiki/Операционная_система#Функции) (ОС). Как правило, при покупке или скачивании какого-то приложения вы обращаете внимание на системные требования. В них обязательно будет указано, какая ОС требуется для его запуска. Получается, что ОС — это некоторая программная платформа, которая нужна для работы приложений. Но откуда взялось это требование? Почему нельзя просто купить компьютер и запустить на нём приложение без всякой ОС?

Эти вопросы кажутся бессмысленными только на первый взгляд. Подумайте сами: современные ОС ввиду своей универсальности имеют множество функций. Большая их часть каждому конкретному пользователю просто не нужна. Но несмотря на это, для обслуживания этих функций ОС активно использует ресурсы компьютера. В результате для полезной нагрузки системы, то есть приложений которые пользователь хочет запустить, ресурсов остаётся намного меньше. Это приводит к медленной работе, зависаниям и даже перезагрузкам компьютера.

На самом деле первые [электромеханические компьютеры](https://ru.wikipedia.org/wiki/Табулятор) вообще не имели ОС. На них работало одно единственное приложение, выполняющее арифметические операции. Данные для этих вычислений загружались с [**перфокарт**](https://ru.wikipedia.org/wiki/Перфокарта). Таким же образом выводились результаты. Несмотря на огромную стоимость таких машин и их узкую специализацию, они были востребованы и успешно применялись для переписи населения США в 1890 году. Это оказалось экономически целесообразнее ручного труда.

Компьютеры успешно обходились без ОС до тех пор, пока оставались узкоспециализированными и выполняли одну единственную задачу. Однако, со временем эксплуатировать такие машины стало слишком дорого. Как правило, они разрабатывались в рамках государственных проектов гражданской или [военной направленности](https://ru.wikipedia.org/wiki/Манхэттенский_проект). Компьютер создавался под конкретный проект, а затем разбирался или простаивал. Если требования проекта менялись, машину не всегда удавалось перестроить для новых задач. Всё это привело к идее, а затем и созданию универсальных или программируемых компьютеров.

Впервые идею универсального компьютера в виде математической модели предложил Алан Тьюринг в 1936 году. Впоследствии эта модель стала известна как [**машина Тьюринга**](https://ru.wikipedia.org/wiki/Машина_Тьюринга). Она описывает абстрактный автомат, который способен выполнить любой [**алгоритм**](https://ru.wikipedia.org/wiki/Алгоритм).

Позднее в 1944 году Джон фон Нейман разработал конкретную архитектуру организации универсальной вычислительной машины. То есть если Алан Тьюринг предложил модель, как эта машина могла бы работать в теории, то Джон фон Нейман разработал способ её реализации на практике. Эта архитектура получила название [**архитектура фон Неймана**](https://ru.wikipedia.org/wiki/Архитектура_фон_Неймана) и применялась для создания первого в мире лампового компьютера [**ENIAC**](https://ru.wikipedia.org/wiki/ЭНИАК). Для ввода и вывода информации в нём использовались перфокарты, как и в более ранних компьютерах. Ключевое отличие заключалось в том, что теперь вместе с данными на перфокартах загружалась и программа для исполнения. Благодаря этому, стало возможно быстро и с минимальными затратами адаптировать компьютер к решению новых задач.

Как только компьютеры стали программируемыми, то есть пользователь получил возможность менять алгоритм их работы, возникли сложности. Загружаемые в них программы, должны были определять все требуемые от компьютера функции. Очень часто эти функции повторялись. Например, операции ввода-вывода или манипуляции с оборудованием. Для экономии времени разработки этот повторяющийся код выносили в служебные программы. Они и стали прототипом будущих ОС.

Вернёмся к нашему вопросу о необходимости ОС. Получается, она совершенно необязательна для запуска приложений на современном персональном компьютере. Такие программы есть и широко распространены. Например, утилиты проверки памяти, разбивки диска, антивирусы. Но их разработка обходится дорого, а запуск неудобен для пользователя, поскольку требует перезагрузки компьютера. Поэтому большинство программ пишется под ОС и использует её возможности.

### Возможности ОС

ОС необязательна, но позволяет быстрее и эффективнее разрабатывать программы. За счёт чего это происходит?

Прототипом ОС стал повторящийся код для разных приложений код, который выносился в отдельные служебные программы. В дальнейшем этот код развивался, в него добавлялись новые функции. В результате разработчики ОС выполнили большую часть работы, которую в противном случае пришлось бы делать программистам пользовательских приложений. Разберёмся подробнее, что же это за функции?

Всё [**аппаратное обеспечение**](https://ru.wikipedia.org/wiki/Аппаратное_обеспечение) компьютера, т.е. его электронные и механические части, можно рассматривать как некоторые ресурсы для вычислений. Программы так или иначе пользуются ими в своих алгоритмах. Но для доступа к каждому виду ресурсов приходится следовать определённым правилам. Например, две программы не могут одновременно писать данные на [жёсткий диск](https://ru.wikipedia.org/wiki/Жёсткий_диск#Технологии_записи_данных) в одну и ту же область. Во-первых, запись осуществляется единственной магнитной головкой жёсткого диска. Во-вторых, данные записанные первым приложением будут затёрты данными второго. Поэтому запросы программ на запись должны быть помещены в очередь и исполняться друг за другом. За механизм обслуживания этой очереди отвечает ОС. Похожим образом организуется доступ ко всем [**периферийным**](https://ru.wikipedia.org/wiki/Периферийное_устройство) и внутренним устройствам компьютера.

Что такое периферийные устройства, и чем они отличаются от внутренних? К периферийным относятся все устройства, отвечающие за ввод и вывод информации, а также её хранение. Например, клавиатура, мышь, микрофон, монитор, колонки, жёсткий диск. Внутренние устройства отвечают за обработку информации, то есть непосредственное исполнение программ. К ним относят [**центральный процессор**](https://ru.wikipedia.org/wiki/Центральный_процессор), [**оперативную память**](https://ru.wikipedia.org/wiki/Оперативная_память), [видеокарту](https://ru.wikipedia.org/wiki/Видеокарта).

Доступ к аппаратным ресурсам — это не единственное, что предоставляет ОС. Кроме них есть программные ресурсы самой ОС. Это тот самый повторяющися код, ставший служебными программами. Например, компонент Windows под названием [**интерфейс графических устройств**](https://ru.wikipedia.org/wiki/GDI) позволяет приложениям манипулировать графическими объектами. С их помощью разработчики могут создавать графический интерфейс для своих программ. К этому типу ресурсов относятся все приложения и компоненты ОС, установленные на компьютере. Кроме собственных программ ОС может предоставлять доступ и к алгоритмам сторонних приложений.

Кроме управления ресурсами, ОС организует работу запущенных приложений. Прежде всего код приложения должен быть загружен с [**устройства хранения информации**](https://ru.wikipedia.org/wiki/Компьютерная_память) (будь то перфокарта или жёсткий диск) и помещён в оперативную память компьютера. Эта процедура нетривиальная, поскольку код всех сторонних библиотек, которые требуются приложению для работы, также должен быть загружен в оперативную память. Процесс запуска и исполнения программы мы рассмотрим подробнее в следующем разделе.

Если ОС многопользовательская, она берёт на себя функции контроля доступа к данным. Таким образом каждый пользователь может работать только со своими собственными данными.

Подведём итог. ОС выполняет следующие функции:

1. Предоставляет доступ к аппаратным ресурсам компьютера.

2. Предоставляет программные ресурсы в виде системных библиотек.

3. Осуществляет запуск приложений.

4. Организует взаимодействие приложений друг с другом.

5. Контролирует доступ пользователей к своим данным.

Изучив эти функции, внимательный читатель возможно догадался, что без ОС невозможно одновременное выполнение нескольких приложений. Ведь их разработчики не могут предусмотреть в каком окружении будет запущена их программа. Только ОС имеет достаточно информации, чтобы эффективно распределить ресурсы компьютера.

### Современные ОС

Мы рассмотрели ОС в общих чертах. Теперь с учётом наших новых знаний поговорим о современных ОС. Они отличаются не столько предоставляемыми функциями, которые у всех почти одинаковы, сколько способами их реализации. Эти особенности реализации и решения, которые к ним привели, принято называть [**архитектурой**](https://ru.wikipedia.org/wiki/Архитектура_программного_обеспечения).

#### Многозадачность

Прежде всего следует заметить, что все современные ОС [**многозадачные**](https://ru.wikipedia.org/wiki/Многозадачность). Это значит, что они поддерживают одновременное исполнение нескольких программ. Почему так получилось?

ОС, которые использовались на первых [персональных компьютерах](https://ru.wikipedia.org/wiki/Персональный_компьютер#История) (PC), были однозадачными. Это было приемлемо, поскольку производительность таких компьютеров была значительно ниже чем у [мэйнфреймов](https://ru.wikipedia.org/wiki/Мейнфрейм), применявшихся в коммерческих целях и государственных проектах. То есть об эффективном одновременном выполнении нескольких программ на PC тогда не было и речи. Возможно, некоторые читатели работали с [MS-DOS](https://ru.wikipedia.org/wiki/MS-DOS). Это хороший пример однозадачной ОС.

Увеличение мощности персональных компьютеров привело к значительному простою центрального процессора. Почему это произошло?

Представьте, что вы работаете над электронной таблицей. Например, заносите список сотрудников вашей компании и их контактные данные. Как бы быстро вы не печатали текст, между нажатиями клавиш проходят миллисекунды. По компьютерным масштабам это огромные промежутки времени, за которые процессор может успеть обработать немало информации. Теперь представьте, что вы забыли чей-то номер и уточняете его у кого-то. Теперь счёт пошёл на секунды и минуты. За это время современный процессор мог бы обработать бухгалтерский отчёт вашей фирмы. Мы рассмотрели только задержки ввода информации, но то же самое происходит и с выводом. Представтье, что на экран вывелось сообщение об ошибке. Несколько сотен миллисекунд у вас уйдёт только на то, чтобы понять, что произошло. Затем вы читаете сообщение. Думаю, вы уже поняли основную идею: в масштабах компьютерного времени пользователь очень медленно реагирует на события.

Чтобы процессор не простаивал, ОС может остановить выполнение приложения, ожидающего действия от пользователя, и предоставить аппаратные ресурсы другой программе, работающей параллельно. Именно в этом заключается суть многозадачности.

Существует несколько способов реализации многозадачности. В современных ОС применяется [**вытесняющая многозадачность**](https://ru.wikipedia.org/wiki/Вытесняющая_многозадачность) с псевдопараллельной обработкой задач. Это означает, что ОС самостоятельно принимает решение о том, какая задача будет выполняться в данный момент времени. При этом выборе учитываются приоритеты задач. То есть более приоритетные будут получать аппаратные ресурсы чаще, чем низкоприоритетные. Псевдопараллельность обработки означает, что в каждый момент времени выполняется одна-единственная задача. Это справедиво для процессоров с одним ядром. Современные процессоры обычно имеют несколько ядер. Поэтому число одновременно выполняемых задач, грубо говоря, равно числу ядер. Но принцип вытесняющей многозадачности с постоянным переключением задач сохраняется.

#### Интерфейс пользователя

Ещё одна общая черта современных ОС для персональных компьютеров и ноутбуков - это наличие [**графического интерфейса пользователя**](https://ru.wikipedia.org/wiki/Графический_интерфейс_пользователя). Благодаря ему пользователь может выбрать задачи или программы для запуска, а также манипулировать некоторыми ресурсами, предоставляемыми ОС (например, файловой системой).

Сегодня графический интерфейс кажется неотъемлемой частью ОС, но исторически возник далеко не сразу. На первых программируемых компьютерах для ввода и вывода информации использовались перфокарты. Таким образом пользователь загружал код программы и её исходные данные. После окончание работы, результаты печатались на принтере. Обслуживание такого интерфейса требовало минимум вычислительных ресурсов. Поэтому он хорошо подходил для маломощных компьютеров того времени.

С увеличением производительности компьютеров и устройств ввода-вывода появилась возможность интерактивного взаимодействия с пользователем в реальном времени. Возник [**интерфейс командной строки**](https://ru.wikipedia.org/wiki/Интерфейс_командной_строки), который позволяет вводить текстовые команды и выводить результат их исполнения на монитор. Основная проблема такого интерфейса заключается в сложности освоения. Список всех доступных команд, как правило, достаточно большой. При этом каждая из них имеет различные входные параметры. Чтобы запомнить хотя бы наиболее часто используемые команды и их параметры, надо потратить немало времени.

Решение проблемы с наглядностью представления доступных команд привело к созданию [**текстового интерфейса пользователя**](https://ru.wikipedia.org/wiki/Текстовый_интерфейс_пользователя). В нём наряду с буквенными и цифровыми символами используется [**псевдографика**](https://ru.wikipedia.org/wiki/Псевдографика). Под псевдографикой подразумеваются специальные символы, отображающие графические примитивы (например, линии, прямоугольники, треугольники и т.д.).

Только благодаря увеличению вычислительной мощности компьютеров, стало возможно заменить текстовый интерфейс на хорошо знакомый нам графический.

#### Семейства ОС

Сегодня на рынке настольных компьютеров доминируют три основных семейства ОС:

* [Windows](https://ru.wikipedia.org/wiki/Windows)
* [Linux](https://ru.wikipedia.org/wiki/Linux)
* [macOS](https://ru.wikipedia.org/wiki/MacOS)

Первые две примечательны тем, что не привязаны к конкретной аппаратной платформе. Это значит, что купив любой персональный компьютер или ноутбук, вы без особых трудностей сможете установить на него Windows или Linux. MacOS в отличие от них рассчитана на запуск только на продукции Apple. Чтобы установить её на чём-то другом, вам потребуются [модифицированная версия ОС](https://ru.wikipedia.org/wiki/OSx86).

ОС во многом определяет инфраструктуру, доступную программисту. Она диктует не только доступные инструменты разработки, такие как IDE, компилятор, система сборки, но и некоторые архитектурные решения. Можно говорить о некоторой сложившейся культуре написания программ под конкретную ОС. Рассмотрим различие этих культур подробнее на примере Windows и Linux.

#### Windows

Как вам известно, Windows — это проприетарная ОС. Это означает, что все её исходные коды закрыты для постороннего изучения и модификации. Вы не сможете законным способом узнать о ней больше, чем разработчики посчитают нужным вам сообщить. Чтобы установить Windows на свой компьютер, вам надо купить её у компании Microsoft. Однако, в большинстве случаев эта ОС уже предустановлена на новые компьютеры и ноутбуки, а её цена включена в стоимость устройства.

Обратите внимание, что целевая платформа Windows — это относительно дешёвые персональные компьютеры. Многие могут позволить себе купить такое устройство. Это огромный рынок потребителей. Поэтому Microsoft стремится всеми силами предотвратить конкуренцию. Компания не хочет, чтобы на рынке появлялись ОС, которые бы копировали возможности Windows. Это желание совершенно справедливо и оправдано. Именно поэтому Microsoft заботится о защите своей интеллектуальной собственности не только техническими, но и юридическими путями. Строго говоря, пользовательское соглашение запрещает вам исследовать внутреннее устройство ОС.

За время существования Windows под неё было написано очень много программ. Первые из них (например пакет офисных приложений [Microsoft Office](https://ru.wikipedia.org/wiki/Microsoft_Office) или [стандартные приложения Windows](https://ru.wikipedia.org/wiki/Категория:Стандартные_приложения_Windows)) создавались самой компанией Microsoft. Для сторонних разработчиков они послужили в некотором роде образцом того, как правильно писать программы под Windows. Очевидно, что Microsoft при разработке своих приложений придерживалась того же принципа закрытости, что и при разработке ОС: исходные коды недоступны конечным пользователям, форматы данных недокументированны, сторонние утилиты не могут получить доступа к возможностям приложений. Опять же это решение было продиктовано заботой о защите интеллектуальной собственности компании от конкурентов.

Сторонние разработчики программ последовали примеру Microsoft и стали придерживаться той же философии закрытости. Большинство получившихся приложений самодостаточны и независимы друг от друга. Форматы их данных, как правило, закодированы и недокументированны.

Если вы опытный пользователь компьютера, вы легко сможете представить себе типичное Windows приложение. Оно представляет собой окно с такими [элементами интерфейса](https://ru.wikipedia.org/wiki/Элемент_интерфейса), как кнопки, поля ввода, вкладки и т.д. Через это окно пользователь манипулирует данными (например текстом, изображением, звуковой записью и т.д.). Результат работы сохраняется на жёсткий диск компьютера и может быть повторно загружен в том же самом приложении. Очень велика вероятность, что если вы напишете собственную программу, она будет работать похожим образом. Именно подобную преемственность решений я имел ввиду, когда говорил о сложившейся культуре разработки под конкретную ОС.

#### Linux

Linux является идейным наследником ОС [Unix](https://ru.wikipedia.org/wiki/Unix) и следует её [**спецификациям**](https://ru.wikipedia.org/wiki/Спецификация). Спецификация - это документ с требованиями к системе, который также определяет её поведени и устройство. Получается, что Linux заимствовал многие идеи и решения Unix, что в результате привело к похожему поведению.

Сама Unix возникла в конце 1960-х годов. Она разрабатывалась как хобби-проект двух инженеров компании Bell Labs: Кеном Томпсоном и Деннисом Ритчи. Всё началось с того, что Кен разработал компьютерную игру [Space Travel](https://ru.wikipedia.org/wiki/Space_Travel). Она запускалась на мэйнфреймах компании General Electric, работающих под управлением ОС GECOS. Эти компьютеры представляли собой шкафы с электроникой, стоили дорого, и их вычислительные ресурсы активно использовались для нужд компании. Поэтому Кен решил портировать свою игру на относительно недорогой компьютер [PDP-7](https://ru.wikipedia.org/wiki/PDP-7) стоимостью порядка 72000$. Проблема была в том, что игра использовала возможности ОС GECOS, которые были недоступны на PDP-7. Поэтому Кену и присоединившемуся к нему Деннису пришлось реализовать несколько библиотек и систем, которые впоследствии развились в Unix.

Очевидно, в своём проекте разработчики Unix не заботились о защите интеллектуальной собственности, поскольку не собирались продавать свою ОС. Она распространялась с открытым исходным кодом, доступным для изучения и модификации любым желающим. Изначально круг пользователей ограничивался сотрудниками компании Bell Labs. Позднее AT&T, которой принадлежала Bell Labs, предоставила исходный код Unix высшим учебным заведениям США. Таким образом развитие ОС продолжилось в университетских кругах.

Linux была создана в 1991 году Линусом Торвальдсом во время его обучения в Хельсинкском университете. Как и у создателей Unix, у него не было коммерческих интересов, связанных с продажей своей ОС. Поэтому она стала бесплатной и свободно распространялась с исходным кодом через Интернет.

На самом деле Linux — это не более чем ядро ОС, предоставляющее функции для работы с памятью, файловой системой, периферийными устройствами, а также управлением процессорным временем. Большинство функций системы были доступны через свободные [пользовательские компоненты GNU](https://ru.wikipedia.org/wiki/Проект_GNU), которые Линус включил в [дистрибутив](https://ru.wikipedia.org/wiki/Дистрибутив_Linux) своей ОС.

Изначально у Linux, как у и Unix, не было графической подсистемы. Все приложения пользователь запускал из [командной строки](https://ru.wikipedia.org/wiki/Интерфейс_командной_строки). В неё же печатались результаты их исполнения. Некоторые из сложных приложений имели [оконный текстовый интерфейс](https://ru.wikipedia.org/wiki/Текстовый_интерфейс_пользователя#Особенности_текстового_интерфейса) пользователя. Со временем в Linux появилась оконная система [X Window System](https://ru.wikipedia.org/wiki/X_Window_System), а вместе с ней и более привычные Windows пользователям приложения с графическим интерфейсом.

Инфраструктура, в которой возник и развивался Linux, во многом определила культуру написания приложений. В ней предпочтение отдаётся узкоспециализированным утилитам командной строки, которые выполняют одну конкретную задачу. Результат работы таких утилит доступен для распространения через открытый формат данных (как правило [текстовый](https://ru.wikipedia.org/wiki/Текстовые_данные)), который можно прочитать в обычном текстовом редакторе. Исходный код самих утилит всегда доступен для модификации.

Культура Linux значительно отличается от стандартов разработки, принятых в Windows. В Windows каждое приложение монолитно и самостоятельно выполняет все необходимые для своей работы задачи. Оно не полагается на сторонние утилиты, которые могут оказаться платными или недоступными для пользователя по какой-то причине. Разработчик должен рассчитывать только на себя. Он не может требовать от пользователя купить что-то дополнительное для работы своего приложения. В Linux же подавляющее большинство утилит бесплатны, взаимозаменяемы и легко доступны через Интернет. Поэтому вполне естественно, что какое-то приложение попросит установить и скачать недостающие ему системные компоненты или другое приложение.

Даже монолитные графические приложения в Linux очень часто имеют текстовый интерфейс. Таким образом они органично вписываются в экосистему и легко интегрируются с другими утилитами и приложениями.

Когда сложный вычислительный процесс строится на использовании набора отдельных узкоспециализированных приложений, становится насущным вопрос написания сценариев, по которому они должны выполняться. Именно для этой задачи была создана [командная оболочка](https://ru.wikipedia.org/wiki/Командная_оболочка_Unix) [Bourne shell](https://ru.wikipedia.org/wiki/Bourne_shell) и её потомок [Bash](https://ru.wikipedia.org/wiki/Bash). Эту командную оболочку мы рассмотрим далее в этой книге.